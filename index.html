<!DOCTYPE html><html>	<head>		<title>Crazy Happy Fun Annihilation</title>	<body><font size = "6"><u><b>Annihilation!</b></u></font><br />This game is written in Javascript using HTML5. Use the mouse button to aimand shoot, and the WASD keys to move your ship around!<br />Now works in all major browsers (except IE11 doesn't play sounds--but who cares, right?)<br />PS: "M" key <b>mutes</b> sounds.<br /><p><script src="js/phaser.js"></script>		<script>////////             Annihilation!//               11-12-19////    Retro 80s-Style Arcade Shooter Game       //           using HTML & Javascript//             with Phaser 3////// Setup the game canvas and functions//var game = new Phaser.Game(1000, 600, Phaser.CANVAS, null, { preload: preload, create: create, update: update, render: render });//// Setup/Initialize global variables////  tell us if we're in play-mode or attract-mode//  we start out in attract mode, so gameRunning is falsevar gameRunning = false;//  these are the graphics variables for the charactersvar sprite;var bullets;var aliens;var coin;var shieldPowerUp;//  these are the sound effects we'll be usingvar pew;var shot;var crash;var powerUp;//  keep track of our ship's health statusvar shipHit;var lifeLost;var lives;var healthBar;//  this causes a delay of 100ms between each shot the Player makesvar fireRate = 400;var nextFire = 0;//  turn sound effects on/offvar muted = false;//  track our scorevar score=0;var scoreBuffer=0;//  These are the keyboard controls to move our shipvar keyLeft;var keyRight;var keyUp;var keyDown;var keyBoost;//  Set time delay for next powerUpvar powerUpTime;var nextPowerUp;var shieldTime;var nextShield;//  This variable shows if the Player is poweredUpvar superPlayer = false;//  these variables count how many aliens have appeared, been killed or escapedvar enemyShips = 0;var shipsLanded = 0;var shipsKilled = 0;// setup points for the curve the powerup coin followsvar points = {            'x': [ 0, 128, 256, 384, 450, 950 ],            'y': [ 240, 240, 240, 240, 240, 240 ]        };var pi = 0;var path= [];// setup points for the curve the shieldPowerUp followsvar shieldpoints = {            'x': [ 0, 64, 356, 584, 650, 940 ],            'y': [ 240, 240, 240, 240, 240, 240 ]        };var shieldpi = 0;var shieldpath= [];//////  Load all our graphics and sounds//function preload() {////  GRAPHICS////  ship and enemy graphics    game.load.image('playerShip', 'img/ship.png');    game.load.image('alien','img/alien.png');    game.load.image('spaceBG','img/space2.png');//  the bullet our ship shoots    game.load.image('bullet', 'img/shot.png');//  the explosion animation when we lose a life    game.load.spritesheet('explosion', 'img/explode.png', 128, 128);//  Our player's health bar is a green bar over the top of a red bar//  when we're hit or an enemy escapes, the green bar scale is adjusted//  down so that more of the red bar shows from underneath    game.load.image('greenHealthBar', 'img/healthbar_green.png');    game.load.image('redHealthBar', 'img/healthbar_red.png');//  load the animation for the spinning powerUp coin    game.load.spritesheet('coin', 'img/coin.png', 84, 84);//  load the animation for the spinning "shield" powerUp    game.load.spritesheet('shieldPowerUp', 'img/shieldPowerUp.png', 30, 32);    ////  SOUNDS////  Our ship's shooting sound    game.load.audio('pew', 'img/pew.wav');//  when the alien ship is hit    game.load.audio('shot', 'img/blop.wav');//  when our ship hits an alien ship    game.load.audio('crash', 'img/crash.mp3');//  when our player loses a life    game.load.audio('lifeLost', 'img/mirror.wav');//  powerUp sound    game.load.audio('powerUp', 'img/powerUp.mp3');//  Explosion animation for when alien gets shot    game.load.atlas('explosion', 'img/explosion.png', 'img/explosion.json');}function create() {//  setup the "M: key to mute sound effects    muteKey = game.input.keyboard.addKey(Phaser.Keyboard.M);    muteKey.onDown.add(toggleMute, this);//  setup 'P' as pause button    pauseKey = game.input.keyboard.addKey(Phaser.Keyboard.P);    pauseKey.onDown.add(togglePause, this);//  setup the WASD keys to move the player    keyLeft = game.input.keyboard.addKey(Phaser.Keyboard.A);    keyRight = game.input.keyboard.addKey(Phaser.Keyboard.D);    keyUp = game.input.keyboard.addKey(Phaser.Keyboard.W);    keyDown = game.input.keyboard.addKey(Phaser.Keyboard.S);    keyBoost = game.input.keyboard.addKey(Phaser.KeyCode.SPACEBAR);//  draw the background    game.add.sprite(0,0,'spaceBG');//  declare game as an object    var me = this;//  call the function to draw the fancy scoreboard    createScore();//  setup physics to be arcade-style    game.physics.startSystem(Phaser.Physics.ARCADE);//  setup the player's bullet    bullets = game.add.group();    bullets.enableBody = true;    bullets.physicsBodyType = Phaser.Physics.ARCADE;//  there can be 50 bullets at a time    bullets.createMultiple(50, 'bullet');//  bullets die automatically when they go offscreen    bullets.setAll('checkWorldBounds', true);    bullets.setAll('outOfBoundsKill', true); //  setup the alien ship physics    aliens = game.add.group();    aliens.enableBody = true;    aliens.physicsBodyType = Phaser.Physics.ARCADE;//  there are 40 aliens at a time    aliens.createMultiple(40,'alien');//  but they don't die when they go off screen//  we just relocate them to the left edge (in a later function)    aliens.setAll('checkWorldBounds',true);    aliens.setAll('outOfBoundsKill',false);//  add the powerUp coin off the left side of the screen invisble    coin = game.add.sprite(-45, 30, 'coin');    coin.scale.setTo(.5,.5);    coin.animations.add('spin');    coin.animations.play('spin',15,true);    coin.exists = false;    coin.enableBody = true;    game.physics.enable(coin, Phaser.Physics.ARCADE);    shieldPowerUp = game.add.sprite(-45,20,'shieldPowerUp');    shieldPowerUp.animations.add('spin');    shieldPowerUp.animations.play('spin',15,true);    shieldPowerUp.exists = false;    shieldPowerUp.enableBody = true;    game.physics.enable(shieldPowerUp, Phaser.Physics.ARCADE);//  Set the time interval for the powerUpCoin to be a random time//  between 5 and 30 seconds    nextPowerUp = game.rnd.integerInRange(5000, 30000);    nextShield = game.rnd.integerInRange(5000, 30000);//  Our Hero!    sprite = game.add.sprite(400, 300, 'playerShip');    sprite.anchor.set(0.5);    sprite.health = 100;    sprite.maxHealth = 100;    game.physics.enable(sprite, Phaser.Physics.ARCADE);//  this allows our ship to rotate    sprite.body.allowRotation = true;//  these initialize the player's health bar at the top of the game//  here's the red bar that goes underneath    var backgroundBar = game.add.image(400,20,'redHealthBar');    backgroundBar.fixedToCamera = true;//  here's the green health bar that lays on top of the red bar    healthBar = game.add.image(400,20, 'greenHealthBar');    healthBar.fixedToCamera = true;    var healthLabel = game.add.text(310, 20, 'Shields:', {fontSize:'20px', fill:'#ffffff'});    healthLabel.fixedToCamera = true;//  This is the label to hold the "Start Game" and "Game Over" text    stateText = game.add.text(game.world.centerX,game.world.centerY,'Annihilation!', { font: '84px Arial', fill: '#f00' });    stateText.anchor.setTo(0.5, 0.5);//  make the start text scale up really large and fade out at the same time    stateText.visible = true;    game.add.tween(stateText).to({alpha: 0}, 3000, Phaser.Easing.Cubic.Out, true, 500);    game.add.tween(stateText.scale).to({x: 4, y: 4}, 3000, Phaser.Easing.Cubic.Out, true, 500);//  Plot the curve the powerUp coin will follow    var py = points.y;    for (var i = 0; i < py.length; i++){            {                py[i] = game.rnd.integerInRange(32, 560);            }            plot();        }//  Plot the curve the shieldPowerUp will follow    var py = shieldpoints.y;    for (var i = 0; i < py.length; i++){            {                py[i] = game.rnd.integerInRange(32, 560);            }            plotShieldPath();        }//  Setup player lives. Right now it is set up for a hard-coded//  3 lives, but that three can be set to a variable in order to//  allow lives to be added on a powerup or something    lives = game.add.group();    for (var i = 0; i < 3; i++)     {        var extraShip = lives.create(game.world.width - 100 + (30 * i), 60, 'playerShip');        extraShip.anchor.setTo(0.5, 0.5);        extraShip.angle = 90;        extraShip.alpha = 0.4;    }//  call the function to setup the Aliens        createAliens();//  tell the camera to follow the player    game.camera.follow(sprite, Phaser.Camera.FOLLOW_LOCKON, 0.1, 0.1);//  assign the sounds to their variable    pew = game.add.audio('pew');    shipHit = game.add.audio('crash');    shot = game.add.audio('shot');    lifeLost = game.add.audio('lifeLost');    powerUp = game.add.audio('powerUp');}////  Setup the class for the explosion animation//function explosionParticle(game, x, y, key, frame) {			        Phaser.Particle.call(this, game, x, y, key, frame);			    }			    explosionParticle.prototype = Object.create(Phaser.Particle.prototype);			    explosionParticle.prototype.constructor = explosionParticle;			    explosionParticle.prototype.onEmit = function() {			        this.animations.add('explosion', Phaser.Animation.generateFrameNames("explosion_",  1, 11, ".png", 2));			        this.animations.play('explosion', 20, false, true);			    }//  Alien explosionfunction playExplosionAdvanced(x, y) {			        emitter     = game.add.emitter(x, y, 6);					emitter.particleClass = explosionParticle;			        emitter.makeParticles('explosion');			        emitter.width = 20;			        emitter.height = 20;			        emitter.minParticleScale = 0.5;			        emitter.maxParticleScale = 3;			        emitter.minParticleSpeed.set(0, 0);			        emitter.maxParticleSpeed.set(0, 0);			        emitter.gravity = 0;			        emitter.start(false, 2000, 50, 6);        			    } ////  Function to plot the path the powerUp coin will follow//function plot() {    path = [];    var x = 1 / game.width;    for (var i = 0; i <= 1; i += x){          var px = game.math.catmullRomInterpolation(points.x, i);          var py = game.math.catmullRomInterpolation(points.y, i);    path.push( { x: px, y: py });    }      }////  Function to plot the path the shieldPowerUp will follow//function plotShieldPath() {    shieldpath = [];    var x = 1 / game.width;    for (var i = 0; i <= 1; i += x){          var px = game.math.bezierInterpolation(shieldpoints.x, i);          var py = game.math.bezierInterpolation(shieldpoints.y, i);    shieldpath.push( { x: px, y: py });    }      }////  Here's where we set up the score board in the top right of the screen//function createScore(){           var me = this;    var scoreFont = "80px Arial";//  Create the score label    me.scoreLabel = me.game.add.text(800, 20, "0", {font: scoreFont, fill: "#ffff00", stroke: "#535353", strokeThickness: 15});     me.scoreLabel.anchor.setTo(0.5, 0);    me.scoreLabel.align = 'center';//  Create a tween to grow / shrink the score label when the score increases    me.scoreLabelTween = game.add.tween(me.scoreLabel.scale).to({ x: 1.5, y: 1.5}, 200, Phaser.Easing.Linear.In).to({ x: 1, y: 1}, 200, Phaser.Easing.Linear.In);}////  Here's where we turn the sound effects on/off//  this function is called when the "M" key is pressed//function toggleMute() {    if (!muted) {      muted = true;}   else {      muted=false;}}function togglePause() {   if (game.paused) {   game.paused = false;} else {   game.paused = true;}}////  Here's where we set up the alien fleet's physical locations//function createAliens () {//  this "40" could be made into a variable to allow//  for more or less aliens onscreen at a time    for (var i = 0; i < 40; i++)    {//  start aliens in random locations on the game canvas            aliens.create( Math.random() * game.width, Math.random() * game.height, 'alien');//  keep track of how many ships there have been total	    enemyShips++;	    }}////  Starts the game over after the player loses//function restart () {//  A new level starts    //  resets the Player's life count    lives.callAll('revive');    //  And brings the aliens back from the dead :)    aliens.removeAll();    createAliens();//  Reset the Player's score to 0 for a new game    score=0;    scoreBuffer=0;    scoreLabel.text = "0";//  revives the player    sprite.revive();    //  hides the "Start Again" text    stateText.visible = false;//  Reset the counter of how many aliens there are    enemyShips=0;    shipsKilled=0;    shipsLanded=0;}////  This is the main game loop that constantly //  keeps all the action moving on the screen//function update() {//  we want to ignore this function if the game is overif (gameRunning) {//  Rotate the Player's ship to follow the mouse    sprite.rotation = game.physics.arcade.angleToPointer(sprite);//  if the mouse is clicked call the "fire" function to shoot    if (game.input.activePointer.isDown)    {        fire();    }//  Checking the keys to move the ship//  Remember we changed these to WASD//  A = Move left//  S = Move down//  W = Move up//  D = Move right//  <space> = boost    var shipspeed = 2    if (keyBoost.isDown) { shipspeed = 4;}    if(keyLeft.isDown) {	if (sprite.x > 0 + shipspeed) {	sprite.x -= shipspeed; }    }    if(keyRight.isDown) {	if (sprite.x < game.width - shipspeed) {sprite.x += shipspeed;}    }    if(keyUp.isDown) {	if (sprite.y > 0 + shipspeed) sprite.y -= shipspeed;    }    if(keyDown.isDown) {	if (sprite.y < game.height - shipspeed) sprite.y += shipspeed;    }    if (game.time.now > nextPowerUp) {            coin.exists = true;                }   if (game.time.now > nextShield) {            shieldPowerUp.exists = true;                } //  Updates the shieldPowerUp on its path if it's been activated and is displayed    if (shieldPowerUp.exists) {	    shieldPowerUp.x = shieldpath[shieldpi].x;            shieldPowerUp.y = shieldpath[shieldpi].y;            shieldpi += 4;//  check for collisions between the Player and the shieldPowerUp//  and called "shieldedUp" function            game.physics.arcade.overlap(sprite, shieldPowerUp, shieldedUp);            if (shieldpi >= shieldpath.length)            {                shieldpi = 0;                // Plot new path                plotShieldPath();                shieldPowerUp.exists = false;		nextShield = game.time.now + game.rnd.integerInRange(5000, 30000);	     }    }//  Updates the powerUp coin on its path if it's been activated and is displayed    if (coin.exists) {	    coin.x = path[pi].x;            coin.y = path[pi].y;            pi += 3;//  check for collisions between the Player and the powerUp coin//  and called "poweredUp" function            game.physics.arcade.overlap(sprite, coin, poweredUp);                        if (pi >= path.length)            {                pi = 0;                // Plot new path                plot();                coin.exists = false;		nextPowerUp = game.time.now + game.rnd.integerInRange(5000, 30000);	     }    }//  Cycle through each one of the aliens    aliens.forEach(function (alien) {//  add code to perform for each member//  this "2" can be made a variable to move the aliens at different speeds    alien.x += 2;//  check if the alien is off the right of the screen, and if it is//  then move it back to the left side in a random location vertically    if (alien.x > game.width) {    alien.x = 0;    alien.y = Math.random() * game.height;//  we only get to this point if an alien moved off the screen, so we//  reduce the player's health by 1 (adding a negative 1)//  this can be made into a variable also    adjustHealth(-1);//  count the new enemy ship we just created on the left side//  and add to the number of ships that escaped    enemyShips++;    shipsLanded++;    }//  checks for collisions between the Player ship and an Alien //  and call the function "collisionHandler" if they have collided    game.physics.arcade.overlap(sprite, alien, collisionHandler);//  cycle through all the Player's bullets onscreen and check //  to see if any aliens are hit, and if they are then we call the//  function "alienShot"    bullets.forEach(function (bullet) {game.physics.arcade.overlap(bullet, alien, alienShot);});    var me = this;//  While there is score in the score buffer, add it to the actual score//  the scoreBuffer is what makes the cool number-scrolling effect//  on the Player score when it's changing    if(scoreBuffer > 0){      incrementScore();      scoreBuffer--;   }});  // ends the cycling through each alien function} else {//  if the game is NOT running then we add a function to start the //  game when the Player clicks the mouse    game.input.onTap.addOnce(function() { gameRunning=true;}, this);}}////  This is what makes the Player score animate //function createScoreAnimation(x, y, message, score){    var me = this;    var scoreFont = "45px Arial";//  Create a new label for the score    var scoreAnimation = me.game.add.text(x, y, message, {font: scoreFont, fill: "#39d179", stroke: "#ffffff", strokeThickness: 15});     scoreAnimation.anchor.setTo(0.5, 0);    scoreAnimation.align = 'center';//Tween this score label from where the alien was shot to the total score label    var scoreTween = me.game.add.tween(scoreAnimation).to({x:800, y: 20}, 800, Phaser.Easing.Exponential.In, true);//When the animation finishes, destroy this score label, trigger the total score label's animation function and add the score    scoreTween.onComplete.add(function(){            scoreAnimation.destroy();            me.scoreLabelTween.start();            me.scoreBuffer += score;        }, me);    }////  this is the function that makes the Player's score actually change//  from the scoreBuffer//function incrementScore(){    if (gameRunning) {        var me = this;    //  Increase the score by one and update the total score label text        me.score += 1;           me.scoreLabel.text = me.score;          }}////  This is what happens when the Player hits the shieldPowerUp coin//function shieldedUp(spriteObject, shieldObject) {//  Play the powerUp sound    powerUp.play();//  turn off shieldPowerUp    shieldPowerUp.exists = false;    pi = 0;    nextShield = game.time.now + game.rnd.integerInRange(5000, 30000);//  Give Player full health    sprite.health = 100;    healthBar.scale.setTo(sprite.health / sprite.maxHealth, 1);}////  This is what happens when the Player hits the powerUp coin//function poweredUp(spriteObject, coinObject) {//  Play the powerUp sound    powerUp.play();//  Enable indestructible bullet and speed up fire rate    superPlayer = true;    fireRate = 100;//  turn off coin    coin.exists = false;    shieldpi = 0;    nextPowerUp = game.time.now + game.rnd.integerInRange(5000, 30000);//  Give Player full health    sprite.health = 100;    healthBar.scale.setTo(sprite.health / sprite.maxHealth, 1);}////  This function is called from the Update function whenever one of the Player's bullets hits an alien//  function alienShot (bulletObject, alienObject) {//  move the alien back to the left side of the screen at a random height as a new alien//  and add one to the number of aliens counter as a new alien    playExplosionAdvanced(alienObject.x + alienObject.width / 2, alienObject.y + alienObject.height / 2);    alienObject.x = 0;    alienObject.y = Math.random() * game.height;    enemyShips++;//  add to the number of aliens the Player has killed    shipsKilled++;//  if the sound hasn't been muted, play the dead alien sound    if (!muted) { shot.play(); }//  get rid of the bullet//  when the Player hits a power up we will make this line read something like//  if (!superPlayer) //  because then when the Player's powered up his bullet will stay active to shoot//  all aliens it hits in its path//  right now it hits one and disappears    if (!superPlayer) {bulletObject.kill();}//  Whenever the player shoots an alien he gets a random score from 1 to 100     var newScore = game.rnd.integerInRange(1, 100);//  and animates that score from where the collision happened to the Player's scoreboard//  on the top right of the screen    createScoreAnimation(bulletObject.x, bulletObject.y, '+'+newScore, newScore);}////  This is what happens when the ship has crashed into an alien//  called from the "Update" function above//function collisionHandler(shipObject, alienObject) {//  cool camera shake effect    game.camera.shake(0.01, 100, true, Phaser.Camera.SHAKE_BOTH, true);//  if the sound effects aren't muted, play the collision sound    if (!muted) { shipHit.play();}//  lose 10 points (this can also be made a variable)    adjustHealth(-10);//  reset the dead alien to the left of the screen as a new alien//  and adjust the alien-tracking counters    alienObject.x = 0;    enemyShips++;    shipsKilled++;    alienObject.y = Math.random() * game.height;}////  Every time the player hits an alien or the alien escapes off the right side of the screen//  we adjust the player's health//function adjustHealth(healthAmount) {//  we ignore this if the Player's already dead    if (sprite.health > 0) {    sprite.health += healthAmount;    healthBar.scale.setTo(sprite.health / sprite.maxHealth, 1);}//  if the Player is dead we kill that life and start a new one    if (sprite.health <= 0) {//  get the first of the three lives we set up on "Create"    live = lives.getFirstAlive();//  if the Player still has another life:    if (live)    {//        play fancy particle explosion, then kill it//        playExplosionAdvanced(live.x, live.y);         live.kill();//  this is the old, less fancy explosion animation//  add the explosion animation as the extra life ship disappears from the scoreboard         var explosion = game.add.sprite(live.x, live.y, 'explosion');  	 explosion.anchor.setTo(0.5, 0.5);         var explode = explosion.animations.add('fire');         explosion.animations.play('fire', 30, false);//  Disable indestructible bullet and speed up fire rate    superPlayer = false;    fireRate = 400;//  if sound effects aren't muted we play the sound for a lost Player life	if (!muted) {lifeLost.play();}//  Reset the health for the new Player life and set the healthBar back to full strength        sprite.health = 100;        healthBar.scale.setTo(sprite.health / sprite.maxHealth, 1);}}//  If the Player has died and there are no lives remaining    if (lives.countLiving() < 1){//  kill everything        sprite.kill();        aliens.callAll('kill');//  set up the "Game Over" label and make it visible        stateText.text=" GAME OVER";        stateText.visible = true;        game.add.tween(stateText).to({alpha: 1}, 3000, Phaser.Easing.Cubic.Out, true, 500);        game.add.tween(stateText.scale).to({x: 1, y: 1}, 3000, Phaser.Easing.Cubic.Out, true, 500);//  tell the Update function to ignore most everything because the game is over        gameRunning = false;//  the "click to restart" handler calls a function "gameOverMan" after waiting four seconds//  to pause long enough to let the Player know the game is over        game.time.events.add(Phaser.Timer.SECOND * 4, gameOverMan, this);    }}////  Adds a handler so that when the Player hits the mouse button//  we call the "restart" function//function gameOverMan() {    game.input.onTap.addOnce(restart,this);}////  This is the function that is called whenever the Player shoots his gun//function fire() {//  only do anything if the game is running (not "Game Over") and only allow//  one bullet every 100 milliseconds (fireRate) and if there are less//  than the total number of bullets allowed at once countDead (i.e. all bullets in the group are live)    if (gameRunning && game.time.now > nextFire && bullets.countDead() > 0)    {//  make sure the following shot has to follow the same delay rule         nextFire = game.time.now + fireRate;//  if sounds aren't muted, play the shot fired sound	if (!muted) { pew.play();}//  use the first available bullet in the group        var bullet = bullets.getFirstDead();// start the bullet at the Player's ship and move toward where the mouse was clicked        bullet.reset(sprite.x - 8, sprite.y - 8);        game.physics.arcade.moveToPointer(bullet, 300);    }}////  This function displays that data like the total number of aliens, number killed and number escaped//function render() {    game.debug.text('Active Bullets: ' + bullets.countLiving() + ' / ' + bullets.total, 32, 32);    game.debug.text('Enemy Ships: ' + enemyShips + '   Enemies Killed: ' + shipsKilled + '    Enemies Landed: ' + shipsLanded,32,430);    game.debug.spriteInfo(sprite, 32, 450);}		</script>	</head>	</body></html>